<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Checkout - Luxe Cosmetics</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        :root {
            --primary-color: #000000;
            --secondary-color: #D4AF37;
            --accent-color: #FFD700;
            --light-color: #f8f8f8;
            --dark-color: #222222;
            --text-color: #333333;
            --light-gray: #f5f5f5;
            --medium-gray: #e0e0e0;
            --dark-gray: #777777;
        }

        /* Checkout Page Styles */
        .checkout-section {
            padding: 80px 0;
            min-height: 70vh;
        }

        .checkout-container {
            display: grid;
            grid-template-columns: 1.5fr 1fr;
            gap: 40px;
        }

        .checkout-form {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }

        .order-summary {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            height: fit-content;
            position: sticky;
            top: 100px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--medium-gray);
            border-radius: 4px;
            font-family: inherit;
        }

        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }

        .phone-input {
            display: flex;
            align-items: center;
            border: 1px solid var(--medium-gray);
            border-radius: 4px;
            overflow: hidden;
        }

        .phone-input .prefix {
            padding: 0 12px;
            background: #f5f5f5;
            height: 100%;
            display: flex;
            align-items: center;
            border-right: 1px solid var(--medium-gray);
        }

        .phone-input input {
            flex: 1;
            border: none;
            padding: 12px;
        }

        .hint {
            display: block;
            margin-top: 5px;
            color: var(--dark-gray);
            font-size: 0.8rem;
        }

        .payment-methods {
            margin: 25px 0;
            border: 1px solid var(--medium-gray);
            border-radius: 8px;
            overflow: hidden;
        }

        .payment-option {
            padding: 15px;
            border-bottom: 1px solid var(--medium-gray);
            display: flex;
            align-items: center;
        }

        .payment-option:last-child {
            border-bottom: none;
        }

        .payment-option input {
            margin-right: 10px;
        }

        .payment-option.coming-soon {
            background-color: #f9f9f9;
            color: var(--dark-gray);
        }

        .cash-notice {
            background-color: #f8f8f8;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            display: flex;
            align-items: center;
            color: var(--secondary-color);
        }

        .cash-notice i {
            margin-right: 10px;
            font-size: 1.2rem;
        }

        .order-items {
            margin-bottom: 30px;
        }

        .order-item {
            display: flex;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid var(--medium-gray);
        }

        .order-item:last-child {
            border-bottom: none;
        }

        .item-image {
            width: 60px;
            height: 60px;
            margin-right: 15px;
            border-radius: 4px;
            overflow: hidden;
        }

        .item-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .item-details {
            flex: 1;
        }

        .item-details h4 {
            margin-bottom: 5px;
            font-size: 1rem;
        }

        .item-details p {
            color: var(--dark-gray);
            font-size: 0.9rem;
        }

        .item-total {
            font-weight: 600;
        }

        .order-totals {
            border-top: 1px solid var(--medium-gray);
            padding-top: 20px;
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
        }

        .summary-row.total {
            font-weight: bold;
            font-size: 1.1rem;
            border-top: 1px solid var(--medium-gray);
            padding-top: 15px;
            margin-top: 15px;
        }

        .btn {
            display: inline-block;
            background-color: var(--secondary-color);
            color: var(--primary-color);
            padding: 12px 25px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s ease;
            text-decoration: none;
        }

        .btn:hover {
            background-color: var(--accent-color);
            transform: translateY(-2px);
        }

        .place-order-btn {
            width: 100%;
            padding: 15px;
            font-size: 1.1rem;
            margin-top: 20px;
        }

        @media (max-width: 768px) {
            .checkout-container {
                grid-template-columns: 1fr;
            }
            
            .order-summary {
                position: static;
                margin-top: 40px;
            }
        }
    </style>
</head>
<body>
    <header class="main-header">
        <div class="container">
            <div class="logo">
                <h1>LUXE</h1>
                <span>Cosmetics</span>
            </div>
            <nav class="main-nav">
                <ul>
                    <li><a href="index.html">Home</a></li>
                    <li><a href="index.html#products">Products</a></li>
                    <li><a href="cart.html" class="cart-link"><i class="fas fa-shopping-cart"></i> <span class="cart-count">0</span></a></li>
                </ul>
            </nav>
        </div>
    </header>

    <section class="checkout-section">
        <div class="container">
            <h2 class="section-title">Checkout</h2>
            
            <div class="checkout-container">
                <div class="checkout-form">
                    <h3>Delivery Information</h3>
                    <form id="checkout-form">
                        <div class="form-group">
                            <label for="email">Email *</label>
                            <input type="email" id="email" name="email" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="phone">Phone Number *</label>
                            <div class="phone-input">
                                <span class="prefix">+212</span>
                                <input type="tel" id="phone" name="phone" pattern="[0-9]{9}" title="Please enter a 9-digit Moroccan phone number" required>
                            </div>
                            <small class="hint">Enter your 9-digit phone number (without +212)</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="city">City *</label>
                            <select id="city" name="city" required>
                                <option value="">Select your city</option>
                                <option value="Casablanca">Casablanca</option>
                                <option value="Rabat">Rabat</option>
                                <option value="Marrakech">Marrakech</option>
                                <option value="Fes">Fes</option>
                                <option value="Tangier">Tangier</option>
                                <option value="Agadir">Agadir</option>
                                <option value="Meknes">Meknes</option>
                                <option value="Oujda">Oujda</option>
                                <option value="Kenitra">Kenitra</option>
                                <option value="Tetouan">Tetouan</option>
                                <option value="Safi">Safi</option>
                                <option value="El Jadida">El Jadida</option>
                                <option value="Beni Mellal">Beni Mellal</option>
                                <option value="Nador">Nador</option>
                                <option value="Taza">Taza</option>
                                <option value="Khouribga">Khouribga</option>
                                <option value="Mohammedia">Mohammedia</option>
                                <option value="Laayoune">Laayoune</option>
                                <option value="Dakhla">Dakhla</option>
                                <option value="Essaouira">Essaouira</option>
                                <option value="Tiznit">Tiznit</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="street">Street *</label>
                            <input type="text" id="street" name="street" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="home-number">Home Number *</label>
                            <input type="text" id="home-number" name="home-number" required>
                        </div>
                        
                        <h3>Payment Method</h3>
                        
                        <div class="payment-methods">
                            <div class="payment-option">
                                <input type="radio" id="cash" name="payment" value="cash" checked>
                                <label for="cash">Cash on Delivery</label>
                            </div>
                            
                            <div class="payment-option coming-soon">
                                <input type="radio" id="credit-card" name="payment" value="credit-card" disabled>
                                <label for="credit-card">Credit Card (Coming Soon)</label>
                            </div>
                            <div class="payment-option coming-soon">
                                <input type="radio" id="bank-transfer" name="payment" value="bank-transfer" disabled>
                                <label for="bank-transfer">Bank Transfer (Coming Soon)</label>
                            </div>
                        </div>
                        
                        <div class="cash-notice">
                            <p><i class="fas fa-info-circle"></i> You will pay in cash when you receive your order</p>
                        </div>
                        
                        <button type="submit" class="btn place-order-btn">Complete Order</button>
                    </form>
                </div>
                
                <div class="order-summary">
                    <h3>Your Order</h3>
                    <div class="order-items" id="order-items">
                        <!-- Cart items will be inserted here by JavaScript -->
                    </div>
                    
                    <div class="order-totals">
                        <div class="summary-row">
                            <span>Subtotal</span>
                            <span id="order-subtotal">$0.00</span>
                        </div>
                        <div class="summary-row">
                            <span>Shipping</span>
                            <span id="order-shipping">$5.99</span>
                        </div>
                        <div class="summary-row total">
                            <span>Total</span>
                            <span id="order-total">$5.99</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <footer class="main-footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>LUXE Cosmetics</h3>
                    <p>Premium beauty products for the modern, sophisticated individual.</p>
                </div>
                <div class="footer-section">
                    <h3>Quick Links</h3>
                    <ul>
                        <li><a href="index.html">Home</a></li>
                        <li><a href="index.html#products">Products</a></li>
                        <li><a href="cart.html">Cart</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h3>Connect With Us</h3>
                    <div class="social-icons">
                        <a href="#"><i class="fab fa-facebook-f"></i></a>
                        <a href="#"><i class="fab fa-instagram"></i></a>
                        <a href="#"><i class="fab fa-twitter"></i></a>
                    </div>
                </div>
            </div>
            <div class="copyright">
                <p>&copy; 2023 Luxe Cosmetics. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Load cart items and display them
            displayOrderSummary();
            
            // Update cart count
            updateCartCount();
            
            // Form submission
            document.getElementById('checkout-form').addEventListener('submit', function(e) {
                e.preventDefault();
                placeOrder();
            });
            
            // Format phone number input
            document.getElementById('phone').addEventListener('input', function() {
                this.value = this.value.replace(/[^0-9]/g, '').slice(0, 9);
            });
        });
        
        function displayOrderSummary() {
            const cart = JSON.parse(localStorage.getItem('cart')) || [];
            const orderItems = document.getElementById('order-items');
            orderItems.innerHTML = '';
            
            if (cart.length === 0) {
                orderItems.innerHTML = '<p>Your cart is empty</p>';
                return;
            }
            
            cart.forEach(item => {
                const itemElement = document.createElement('div');
                itemElement.className = 'order-item';
                itemElement.innerHTML = `
                    <div class="item-image">
                        <img src="${item.image}" alt="${item.name}">
                    </div>
                    <div class="item-details">
                        <h4>${item.name}</h4>
                        <p>$${item.price.toFixed(2)} × ${item.quantity}</p>
                    </div>
                    <div class="item-total">
                        $${(item.price * item.quantity).toFixed(2)}
                    </div>
                `;
                orderItems.appendChild(itemElement);
            });
            
            // Update totals
            const subtotal = cart.reduce((total, item) => total + (item.price * item.quantity), 0);
            const shipping = subtotal > 0 ? 5.99 : 0;
            const total = subtotal + shipping;
            
            document.getElementById('order-subtotal').textContent = `$${subtotal.toFixed(2)}`;
            document.getElementById('order-shipping').textContent = `$${shipping.toFixed(2)}`;
            document.getElementById('order-total').textContent = `$${total.toFixed(2)}`;
        }
        
        async function placeOrder() {
            const cart = JSON.parse(localStorage.getItem('cart')) || [];
            
            if (cart.length === 0) {
                alert('Your cart is empty!');
                return;
            }
            
            // Validate form
            const email = document.getElementById('email').value;
            const phone = document.getElementById('phone').value;
            const city = document.getElementById('city').value;
            const street = document.getElementById('street').value;
            const homeNumber = document.getElementById('home-number').value;
            
            if (!email || !phone || phone.length !== 9 || !city || !street || !homeNumber) {
                alert('Please fill all required fields correctly');
                return;
            }
            
            // Prepare order data
            const formData = {
                email: email,
                phone: '+212' + phone,
                city: city,
                street: street,
                homeNumber: homeNumber,
                paymentMethod: 'cash',
                items: cart,
                total: document.getElementById('order-total').textContent,
                orderNumber: 'LX-' + Math.floor(Math.random() * 10000)
            };
            
            // Format WhatsApp message
            const itemsText = formData.items.map(item => 
                `➤ ${item.name} (${item.quantity} × ${item.price} DH) = ${(item.quantity * item.price).toFixed(2)} DH`
            ).join('\n');
            
            const message = `*NEW ORDER - LUXE COSMETICS*\n\n` +
                            `*Order Number:* ${formData.orderNumber}\n` +
                            `*Customer Email:* ${formData.email}\n` +
                            `*Phone:* ${formData.phone}\n` +
                            `*Delivery Address:*\n${formData.street}, ${formData.homeNumber}\n${formData.city}\n\n` +
                            `*Order Items:*\n${itemsText}\n\n` +
                            `*Total Amount:* ${formData.total}\n` +
                            `*Payment Method:* Cash on Delivery`;
            
            try {
                // Show loading state
                const submitBtn = document.querySelector('.place-order-btn');
                submitBtn.disabled = true;
                submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing Order...';
                
                // Save order to localStorage
                localStorage.setItem('lastOrder', JSON.stringify(formData));
                
                // Send to WhatsApp (using server endpoint)
                const response = await fetch('https://your-server.com/send-whatsapp', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        message: message,
                        phone: '212659214817' // Your business WhatsApp number
                    })
                });
                
                if (!response.ok) {
                    throw new Error('Failed to send WhatsApp notification');
                }
                
                // Clear cart and redirect
                localStorage.removeItem('cart');
                window.location.href = 'thank-you.html?order=' + formData.orderNumber;
                
            } catch (error) {
                console.error('Error:', error);
                alert('Order placed successfully, but we couldn\'t send confirmation. Please contact us.');
                window.location.href = 'thank-you.html?order=' + formData.orderNumber;
            }
        }
        
        function updateCartCount() {
            const cart = JSON.parse(localStorage.getItem('cart')) || [];
            const count = cart.reduce((total, item) => total + item.quantity, 0);
            document.querySelectorAll('.cart-count').forEach(element => {
                element.textContent = count;
            });
        }
    </script>
    <script>
    // CallMeBot Configuration - REPLACE THESE VALUES
    const CALLMEBOT_API_KEY = '7409374'; // Get from https://www.callmebot.com/
    const BUSINESS_PHONE = '212702382376'; // Your business WhatsApp number (without +)
    
    document.addEventListener('DOMContentLoaded', function() {
        displayOrderSummary();
        updateCartCount();
        
        document.getElementById('checkout-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            await placeOrder();
        });
        
        document.getElementById('phone').addEventListener('input', function() {
            this.value = this.value.replace(/[^0-9]/g, '').slice(0, 9);
        });
    });
    
    function displayOrderSummary() {
        const cart = JSON.parse(localStorage.getItem('cart')) || [];
        const orderItems = document.getElementById('order-items');
        orderItems.innerHTML = '';
        
        if (cart.length === 0) {
            orderItems.innerHTML = '<p>Your cart is empty</p>';
            return;
        }
        
        cart.forEach(item => {
            const itemElement = document.createElement('div');
            itemElement.className = 'order-item';
            itemElement.innerHTML = `
                <div class="item-image">
                    <img src="${item.image}" alt="${item.name}">
                </div>
                <div class="item-details">
                    <h4>${item.name}</h4>
                    <p>${item.price.toFixed(2)} DH × ${item.quantity}</p>
                </div>
                <div class="item-total">
                    ${(item.price * item.quantity).toFixed(2)} DH
                </div>
            `;
            orderItems.appendChild(itemElement);
        });
        
        updateTotals();
    }
    
    function updateTotals() {
        const cart = JSON.parse(localStorage.getItem('cart')) || [];
        const subtotal = cart.reduce((total, item) => total + (item.price * item.quantity), 0);
        const shipping = subtotal > 0 ? 5.99 : 0;
        const total = subtotal + shipping;
        
        document.getElementById('order-subtotal').textContent = `${subtotal.toFixed(2)} DH`;
        document.getElementById('order-shipping').textContent = `${shipping.toFixed(2)} DH`;
        document.getElementById('order-total').textContent = `${total.toFixed(2)} DH`;
    }
    
    async function placeOrder() {
        const cart = JSON.parse(localStorage.getItem('cart')) || [];
        if (cart.length === 0) return alert('Your cart is empty!');
        
        // Get form values
        const formData = {
            email: document.getElementById('email').value,
            phone: document.getElementById('phone').value,
            city: document.getElementById('city').value,
            street: document.getElementById('street').value,
            homeNumber: document.getElementById('home-number').value,
            orderNumber: 'LX-' + Date.now().toString().slice(-6)
        };
        
        // Validate inputs
        if (!validateForm(formData)) return;
        
        // Prepare WhatsApp message
        const itemsText = cart.map(item =>
            `➤ ${item.name} (${item.quantity}x) - ${item.price.toFixed(2)} DH`
        ).join('%0A');
        
        const message = `*NEW ORDER - LUXE COSMETICS*%0A%0A` +
            `*Order #:* ${formData.orderNumber}%0A` +
            `*Email:* ${formData.email}%0A` +
            `*Phone:* +212${formData.phone}%0A` +
            `*Address:* ${formData.street} No.${formData.homeNumber}, ${formData.city}%0A%0A` +
            `*ITEMS*%0A${itemsText}%0A%0A` +
            `*Total:* ${document.getElementById('order-total').textContent}`;
        
        try {
            const submitBtn = document.querySelector('.place-order-btn');
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';
            
            // Send WhatsApp notification
            const whatsappResponse = await fetch(
                `https://api.callmebot.com/whatsapp.php?phone=${BUSINESS_PHONE}&text=${encodeURIComponent(message)}&apikey=${CALLMEBOT_API_KEY}`
            );
            
            if (!whatsappResponse.ok) throw new Error('WhatsApp send failed');
            
            // Clear cart and redirect
            localStorage.removeItem('cart');
            window.location.href = `thank-you.html?order=${formData.orderNumber}`;
            
        } catch (error) {
            console.error('Error:', error);
            alert('Order received! We will contact you shortly.');
            window.location.href = `thank-you.html?order=${formData.orderNumber}`;
        }
    }
    
    function validateForm(formData) {
        if (!formData.email.match(/^\w+@[a-zA-Z_]+?\.[a-zA-Z]{2,3}$/)) {
            alert('Please enter a valid email address');
            return false;
        }
        if (formData.phone.length !== 9) {
            alert('Please enter a valid 9-digit phone number');
            return false;
        }
        if (!formData.city || !formData.street || !formData.homeNumber) {
            alert('Please fill all address fields');
            return false;
        }
        return true;
    }
    
    function updateCartCount() {
        const cart = JSON.parse(localStorage.getItem('cart')) || [];
        const count = cart.reduce((total, item) => total + item.quantity, 0);
        document.querySelectorAll('.cart-count').forEach(el => el.textContent = count);
    }
</script>
</body>
</html>